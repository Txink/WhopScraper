# Parser输出格式对比

## 新独立表格格式 ✨

### 命令
```bash
python3 analyze_local_messages.py debug/page_20260202_000748.html
```

### 输出示例
```
============================================================================================================================================
【指令解析 - 转化为Broker可用指令】
============================================================================================================================================

                                       #4 BUY - LYFT                             
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 字段               ┃ 值                                                  ┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 时间               │ Jan 12, 2026 11:40 PM                              │
│ 期权代码           │ LYFT                                               │
│ 指令类型           │ BUY                                                │
│ 状态               │ ✅                                                  │
│ 期权类型           │ CALL                                               │
│ 行权价             │ $19.5                                              │
│ 到期日             │ 1/23                                               │
│ 价格               │ $0.58                                              │
│ 仓位大小           │ 小仓位                                              │
│ 原始消息           │ LYFT 19.5c 1/23 0.58-0.62 日内交易小仓位            │
└──────────────────┴────────────────────────────────────────────────────┘

                                       #6 SELL - 未识别                             
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 字段               ┃ 值                                                  ┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 时间               │ Jan 12, 2026 11:44 PM                              │
│ 期权代码           │ 未识别                                              │
│ 指令类型           │ SELL                                               │
│ 状态               │ ✅                                                  │
│ 价格               │ $0.7                                               │
│ 卖出数量           │ 1/2                                                │
│ 原始消息           │ 0.7出一半 lyft期权 进入价内                          │
└──────────────────┴────────────────────────────────────────────────────┘

                                      #14 CLOSE - 未识别                            
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 字段               ┃ 值                                                  ┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 时间               │ Jan 13, 2026 10:59 PM                              │
│ 期权代码           │ 未识别                                              │
│ 指令类型           │ CLOSE                                              │
│ 状态               │ ✅                                                  │
│ 价格               │ $0.92                                              │
│ 数量               │ 全部                                               │
│ 原始消息           │ 0.92出剩下的xom等下找机会平移往下买                  │
└──────────────────┴────────────────────────────────────────────────────┘

                                      #19 MODIFY - 未识别                           
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 字段               ┃ 值                                                  ┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ 时间               │ Jan 20, 2026 10:37 PM                              │
│ 期权代码           │ 未识别                                              │
│ 指令类型           │ MODIFY                                             │
│ 状态               │ ✅                                                  │
│ 止损价格           │ $1.0                                               │
│ 原始消息           │ INTC - $52 CALLS 1月30  1.25 止损在1.00  小仓位      │
└──────────────────┴────────────────────────────────────────────────────┘

================================================================================
📊 解析统计: 总消息=91 | 成功=64 | 失败=27 | 成功率=70.3%
================================================================================
```

### 优点 ✅

1. **独立卡片展示** - 每个指令独立显示，类似订单卡片
2. **结构化字段** - 所有字段清晰分行展示
3. **详细信息** - 根据指令类型展示不同的详细字段
4. **美观的边框** - 使用Unicode字符绘制专业表格
5. **易于阅读** - 每个指令一目了然，不会混淆
6. **保留原始消息** - 方便调试和验证

---

## 旧格式（对比）

### 命令
```bash
# 之前的版本
python3 analyze_local_messages.py debug/page_20260202_000748.html
```

### 输出示例
```
========================================================================================================================
【指令解析 - 转化为Broker可用指令】
========================================================================================================================
 Jan 12, 2026 11:40 PM  LYFT     ✅ [解析成功] [买入] LYFT $19.5 CALL @ $0.58 (1/23) 小仓位
 Jan 12, 2026 11:40 PM  CMCSA    ✅ [解析成功] [买入] CMCSA $30.0 CALL @ $0.83 (2/20) 小仓位
 Jan 12, 2026 11:44 PM  未识别      ✅ [解析成功] [卖出] 未识别 @ $0.7 数量: 1/2
 Jan 12, 2026 11:44 PM  未识别      ✅ [解析成功] [卖出] 未识别 @ $0.7 数量: 1/2
 Jan 13, 2026 1:04 AM   未识别      ✅ [解析成功] [卖出] 未识别 @ $0.92 数量: 1/3
 Jan 13, 2026 1:17 AM   未识别      ✅ [解析成功] [卖出] 未识别 @ $0.93 数量: 1/3
 Jan 13, 2026 1:51 AM   CMCSA    ❌ [解析失败] 0.94出掉剩下的cmcsa期权
 Jan 13, 2026 10:49 PM  XOM      ❌ [解析失败] $XOM 1/16 $127 call  0.8-0.85 小仓位
 Jan 13, 2026 10:49 PM  未识别      ✅ [解析成功] [卖出] 未识别 @ $1.06 数量: 1/3
========================================================================================================================
解析完成: 总消息数=91, 成功=64, 失败=27, 成功率=70.3%
========================================================================================================================
```

### 问题 ❌

1. **列不对齐** - 时间戳长度不一致导致后面列错位
2. **冗余标签** - "[解析成功]"重复出现，增加噪音
3. **难以扫描** - 没有清晰的列分隔
4. **不易过滤** - 难以快速找到特定类型的指令

---

## 环境变量控制

### 显示输出（默认）
```bash
python3 analyze_local_messages.py debug/page.html
# 或
SHOW_PARSER_OUTPUT=true python3 analyze_local_messages.py debug/page.html
```

### 隐藏输出（适用于broker下单）
```bash
SHOW_PARSER_OUTPUT=false python3 analyze_local_messages.py debug/page.html
```

**好处**：
- ✅ 避免与broker下单信息冲突
- ✅ 保持命令行输出清晰
- ✅ 适用于生产环境

---

## 表格列说明

| 列名 | 宽度 | 说明 | 示例 |
|------|------|------|------|
| 时间 | 24字符 | 消息发送时间 | Jan 12, 2026 11:40 PM |
| 代码 | 8字符 | 期权代码（ticker） | LYFT, CMCSA, 未识别 |
| 状态 | 6字符 | 解析状态 | ✅ / ❌ |
| 类型 | 8字符 | 指令类型 | BUY, SELL, CLOSE, MODIFY, FAILED |
| 详情 | 80字符 | 完整的指令内容或错误信息 | [买入] LYFT $19.5 CALL @ $0.58 (1/23) 小仓位 |

---

## 使用建议

### 开发/调试时
使用默认设置（显示输出），便于：
- 验证解析逻辑
- 定位解析失败的消息
- 观察指令类型分布

### 生产/下单时
隐藏Parser输出（`SHOW_PARSER_OUTPUT=false`），便于：
- 只关注broker下单信息
- 保持命令行清晰
- 减少日志文件大小

### 日志分析时
使用表格格式配合grep/awk：
```bash
# 只看买入指令
python3 analyze_local_messages.py data.html | grep "BUY"

# 只看失败的解析
python3 analyze_local_messages.py data.html | grep "FAILED"

# 统计各类指令数量
python3 analyze_local_messages.py data.html | grep -E "BUY|SELL|CLOSE|MODIFY" | awk '{print $5}' | sort | uniq -c
```
