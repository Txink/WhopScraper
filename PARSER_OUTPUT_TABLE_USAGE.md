# Parser输出 - Rich Table组件使用说明

## 概述

Parser层现在使用Python `rich`库的Table组件来展示解析结果，提供美观、专业的表格卡片式输出。

## 技术栈

- **库**: `rich` (版本 14.3.1)
- **组件**: `rich.table.Table`
- **边框样式**: `box.ROUNDED` (圆角边框)
- **统计样式**: `box.DOUBLE` (双线边框)

## 输出效果

### 买入指令 (BUY)

```
                                 #4 BUY - LYFT                                  
╭────────────────────┬─────────────────────────────────────────────────────────╮
│ 字段               │ 值                                                      │
├────────────────────┼─────────────────────────────────────────────────────────┤
│ 时间               │ Jan 12, 2026 11:40 PM                                   │
│ 期权代码           │ LYFT                                                    │
│ 指令类型           │ BUY                                                     │
│ 状态               │ ✅                                                      │
│ 期权类型           │ CALL                                                    │
│ 行权价             │ $19.5                                                   │
│ 到期日             │ 1/23                                                    │
│ 价格               │ $0.58                                                   │
│ 仓位大小           │ 小仓位                                                  │
│ 原始消息           │ LYFT 19.5c 1/23 0.58-0.62 日内交易小仓位                │
╰────────────────────┴─────────────────────────────────────────────────────────╯
```

### 卖出指令 (SELL)

```
                                #6 SELL - 未识别                                
╭────────────────────┬─────────────────────────────────────────────────────────╮
│ 字段               │ 值                                                      │
├────────────────────┼─────────────────────────────────────────────────────────┤
│ 时间               │ Jan 12, 2026 11:44 PM                                   │
│ 期权代码           │ 未识别                                                  │
│ 指令类型           │ SELL                                                    │
│ 状态               │ ✅                                                      │
│ 价格               │ $0.7                                                    │
│ 卖出数量           │ 1/2                                                     │
│ 原始消息           │ 0.7出一半 lyft期权 进入价内                              │
╰────────────────────┴─────────────────────────────────────────────────────────╯
```

### 清仓指令 (CLOSE)

```
                               #14 CLOSE - 未识别                               
╭────────────────────┬─────────────────────────────────────────────────────────╮
│ 字段               │ 值                                                      │
├────────────────────┼─────────────────────────────────────────────────────────┤
│ 时间               │ Jan 13, 2026 10:59 PM                                   │
│ 期权代码           │ 未识别                                                  │
│ 指令类型           │ CLOSE                                                   │
│ 状态               │ ✅                                                      │
│ 价格               │ $0.92                                                   │
│ 数量               │ 全部                                                    │
│ 原始消息           │ 0.92出剩下的xom等下找机会平移往下买                      │
╰────────────────────┴─────────────────────────────────────────────────────────╯
```

### 修改指令 (MODIFY)

```
                               #19 MODIFY - 未识别                              
╭────────────────────┬─────────────────────────────────────────────────────────╮
│ 字段               │ 值                                                      │
├────────────────────┼─────────────────────────────────────────────────────────┤
│ 时间               │ Jan 20, 2026 10:37 PM                                   │
│ 期权代码           │ 未识别                                                  │
│ 指令类型           │ MODIFY                                                  │
│ 状态               │ ✅                                                      │
│ 止损价格           │ $1.0                                                    │
│ 原始消息           │ INTC - $52 CALLS 1月30  1.25 止损在1.00  小仓位          │
╰────────────────────┴─────────────────────────────────────────────────────────╯
```

### 统计信息表格

```
                                  📊 解析统计                                   
╔══════════════════════════════════════════════════════════════════════════════╗
║ 总消息数: 91 | 成功: 64 | 失败: 27 | 成功率: 70.3%                           ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 视觉特点

### 标题颜色

- **成功指令**: 绿色粗体标题 (bold green)
  - `#4 BUY - LYFT`
  - `#6 SELL - 未识别`
  - `#14 CLOSE - 未识别`

- **失败指令**: 红色粗体标题 (bold red)
  - `#1 解析失败 - 未识别`

- **统计信息**: 黄色粗体标题 (bold yellow)
  - `📊 解析统计`

### 列样式

- **字段列**: 青色 (cyan)，固定宽度18字符，不换行
- **值列**: 白色 (white)，固定宽度56字符

### 边框样式

- **指令表格**: `ROUNDED` - 圆角边框 `╭─╮│╰─╯`
- **统计表格**: `DOUBLE` - 双线边框 `╔═╗║╚═╝`

## 表格配置

```python
from rich.table import Table
from rich import box

# 创建指令表格
table = Table(
    title="#{idx} {type} - {ticker}",
    title_style="bold green",  # 或 "bold red"
    box=box.ROUNDED,
    show_header=True,
    header_style="bold cyan",
    width=80,
    padding=(0, 1)
)

# 添加列
table.add_column("字段", style="cyan", width=18, no_wrap=True)
table.add_column("值", style="white", width=56, no_wrap=False)

# 添加行
table.add_row("时间", "Jan 12, 2026 11:40 PM")
table.add_row("期权代码", "LYFT")
# ...

# 渲染
console = Console()
console.print(table)
```

## 环境变量控制

### SHOW_PARSER_OUTPUT

控制是否显示Parser表格输出。

```bash
# 显示表格（默认）
python3 analyze_local_messages.py data.html

# 隐藏表格
SHOW_PARSER_OUTPUT=false python3 analyze_local_messages.py data.html
```

## 依赖安装

```bash
# rich库已安装（版本14.3.1）
pip install rich

# 或更新到最新版本
pip install --upgrade rich
```

## 优势

### 1. 美观性
- ✅ 专业的圆角边框
- ✅ 颜色区分不同状态
- ✅ 清晰的视觉层次

### 2. 可读性
- ✅ 每个指令独立展示
- ✅ 结构化字段一目了然
- ✅ 不会混淆

### 3. 可维护性
- ✅ 使用成熟的第三方库
- ✅ 代码简洁易维护
- ✅ 易于扩展新字段

### 4. 跨平台
- ✅ 自动适配终端能力
- ✅ 支持Unicode和ASCII模式
- ✅ 兼容各种终端

## 与之前格式对比

### 旧格式（手动Unicode）
- ❌ 手动绘制边框，容易出错
- ❌ 对齐需要精确计算
- ❌ 不支持颜色
- ❌ 代码冗长

### 新格式（Rich Table）
- ✅ 自动边框渲染
- ✅ 自动对齐和换行
- ✅ 内置颜色支持
- ✅ 代码简洁

## 注意事项

1. **换行处理**: 原始消息中的换行符会被替换为空格
2. **长度限制**: 原始消息最多显示75个字符，超出部分截断
3. **终端宽度**: 表格宽度固定为80字符，建议终端宽度>=100

## 示例代码

完整实现见 `analyze_local_messages.py` 文件第 103-294 行。

## 相关文档

- `CHANGELOG.md` - 完整变更记录
- `README_PARSER_OUTPUT.md` - 输出控制说明
- `.env.example` - 环境变量配置模板
