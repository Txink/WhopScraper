# æ•…éšœæ’æŸ¥æŒ‡å—

æœ¬æ–‡æ¡£å¸®åŠ©æ‚¨è§£å†³ä½¿ç”¨ Whop æŠ“å–å™¨æ—¶é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚

## ğŸ“‹ ç›®å½•

- [é¡µé¢åŠ è½½é—®é¢˜](#é¡µé¢åŠ è½½é—®é¢˜)
- [ç™»å½•å’Œ Cookie é—®é¢˜](#ç™»å½•å’Œ-cookie-é—®é¢˜)
- [æ¶ˆæ¯æå–é—®é¢˜](#æ¶ˆæ¯æå–é—®é¢˜)
- [æ€§èƒ½å’Œè¶…æ—¶é—®é¢˜](#æ€§èƒ½å’Œè¶…æ—¶é—®é¢˜)
- [ä¾èµ–å’Œå®‰è£…é—®é¢˜](#ä¾èµ–å’Œå®‰è£…é—®é¢˜)

## é¡µé¢åŠ è½½é—®é¢˜

### âŒ é”™è¯¯: `TimeoutError: Page.goto: Timeout 30000ms exceeded`

**åŸå› **ï¼šé¡µé¢åŠ è½½è¶…æ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸ºï¼š
1. å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ç½‘ç»œè¯·æ±‚ä¸€ç›´åœ¨è¿›è¡Œ
2. ç½‘ç»œè¿æ¥æ…¢
3. ç­‰å¾…ç­–ç•¥å¤ªä¸¥æ ¼ï¼ˆ`networkidle`ï¼‰

**è§£å†³æ–¹æ³•**ï¼š

å·²åœ¨è„šæœ¬ä¸­è‡ªåŠ¨ä¿®å¤ï¼Œç°åœ¨ä½¿ç”¨æ›´å®½æ¾çš„ç­‰å¾…ç­–ç•¥ï¼š

```python
# æ—§ä»£ç ï¼ˆå®¹æ˜“è¶…æ—¶ï¼‰
await page.goto(url, wait_until='networkidle')

# æ–°ä»£ç ï¼ˆæ›´å®¹é”™ï¼‰
await page.goto(
    url,
    wait_until='domcontentloaded',  # åªç­‰å¾… DOM åŠ è½½å®Œæˆ
    timeout=60000  # å¢åŠ è¶…æ—¶æ—¶é—´åˆ° 60 ç§’
)
```

**æ‰‹åŠ¨è°ƒè¯•**ï¼š

å¦‚æœä»ç„¶è¶…æ—¶ï¼Œå¯ä»¥å°è¯•ï¼š

```bash
# 1. ä½¿ç”¨éæ— å¤´æ¨¡å¼æŸ¥çœ‹æµè§ˆå™¨
python3 whop_scraper_simple.py --url "URL"  # ä¸è¦åŠ  --headless

# 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping whop.com

# 3. å°è¯•æ›´é•¿çš„è¶…æ—¶æ—¶é—´
# ç¼–è¾‘è„šæœ¬ï¼Œå°† timeout=60000 æ”¹ä¸º timeout=120000
```

### âš ï¸ é¡µé¢åŠ è½½è­¦å‘Šä½†ç»§ç»­è¿è¡Œ

**ç°è±¡**ï¼šçœ‹åˆ° "âš ï¸ é¡µé¢åŠ è½½è­¦å‘Š" ä½†è„šæœ¬ç»§ç»­è¿è¡Œ

**è¯´æ˜**ï¼šè¿™æ˜¯æ­£å¸¸çš„ï¼è„šæœ¬ç°åœ¨ä¼šæ•è·è¶…æ—¶é”™è¯¯ä½†ç»§ç»­æ‰§è¡Œï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹é¡µé¢å·²ç»éƒ¨åˆ†åŠ è½½ï¼Œè¶³å¤Ÿæå–æ¶ˆæ¯äº†ã€‚

**å¤„ç†æ–¹å¼**ï¼š
- âœ… å¦‚æœèƒ½æ­£å¸¸æå–æ¶ˆæ¯ï¼Œå¿½ç•¥è­¦å‘Š
- âš ï¸ å¦‚æœæ— æ³•æå–æ¶ˆæ¯ï¼ŒæŸ¥çœ‹ä¸‹é¢çš„"æ¶ˆæ¯æå–é—®é¢˜"éƒ¨åˆ†

## ç™»å½•å’Œ Cookie é—®é¢˜

### âŒ Cookie å·²è¿‡æœŸ

**ç°è±¡**ï¼š
```
âŒ Cookie å·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•
```

**è§£å†³æ–¹æ³•**ï¼š

```bash
# é‡æ–°ç™»å½•å¹¶ä¿å­˜ Cookie
python3 whop_login.py
```

**å®šæœŸæ£€æŸ¥**ï¼š

```bash
# å®šæœŸæµ‹è¯• Cookie æ˜¯å¦æœ‰æ•ˆ
python3 whop_login.py --test
```

**è‡ªåŠ¨åŒ–æ£€æŸ¥**ï¼ˆæ·»åŠ åˆ° crontabï¼‰ï¼š

```bash
# æ¯å¤©æ—©ä¸Š 9 ç‚¹æµ‹è¯• Cookie
0 9 * * * cd /path/to/playwright && python3 whop_login.py --test >> /path/to/logs/cookie_test.log 2>&1
```

### âŒ æ‰¾ä¸åˆ° Cookie æ–‡ä»¶

**ç°è±¡**ï¼š
```
âŒ æ‰¾ä¸åˆ° cookie æ–‡ä»¶: storage_state.json
```

**è§£å†³æ–¹æ³•**ï¼š

```bash
# é¦–æ¬¡ä½¿ç”¨éœ€è¦å…ˆç™»å½•
python3 whop_login.py
```

**æ£€æŸ¥æ–‡ä»¶**ï¼š

```bash
# æŸ¥çœ‹ Cookie æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la storage_state.json

# æŸ¥çœ‹æ–‡ä»¶å¤§å°ï¼ˆåº”è¯¥ > 0ï¼‰
du -h storage_state.json
```

### âŒ è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢

**ç°è±¡**ï¼šè®¿é—®ç›®æ ‡é¡µé¢æ—¶è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢

**åŸå› **ï¼š
1. Cookie å·²è¿‡æœŸ
2. Cookie æ–‡ä»¶æŸå
3. Whop æ£€æµ‹åˆ°è‡ªåŠ¨åŒ–è®¿é—®

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ–¹æ³• 1: é‡æ–°ç™»å½•
python3 whop_login.py

# æ–¹æ³• 2: åˆ é™¤æ—§ Cookie å¹¶é‡æ–°ç™»å½•
rm storage_state.json
python3 whop_login.py

# æ–¹æ³• 3: ä½¿ç”¨æ›´çœŸå®çš„æµè§ˆå™¨æŒ‡çº¹
# è„šæœ¬å·²ç»é…ç½®äº†çœŸå®çš„ User-Agentï¼Œé€šå¸¸æ— éœ€ä¿®æ”¹
```

### âŒ éœ€è¦éªŒè¯ç 

**ç°è±¡**ï¼šç™»å½•æ—¶å¼¹å‡ºéªŒè¯ç ï¼ˆCAPTCHAï¼‰

**è§£å†³æ–¹æ³•**ï¼š

1. **æ‰‹åŠ¨å®ŒæˆéªŒè¯ç **ï¼š
   - è„šæœ¬ä¼šæ‰“å¼€æµè§ˆå™¨çª—å£
   - åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨å®ŒæˆéªŒè¯ç 
   - å®Œæˆåè¿”å›ç»ˆç«¯æŒ‰å›è½¦

2. **å‡å°‘è‡ªåŠ¨åŒ–ç‰¹å¾**ï¼š
   - å·²åœ¨è„šæœ¬ä¸­æ·»åŠ  `--disable-blink-features=AutomationControlled`
   - ä½¿ç”¨çœŸå®çš„ User-Agent
   - æ·»åŠ éšæœºå»¶è¿Ÿ

3. **ä½¿ç”¨å·²ç™»å½•çš„æµè§ˆå™¨**ï¼š
   ```bash
   # å…ˆåœ¨æ­£å¸¸æµè§ˆå™¨ä¸­ç™»å½• Whop
   # ç„¶åå¯¼å‡º Cookie åˆ° storage_state.json
   # ï¼ˆéœ€è¦ä½¿ç”¨æµè§ˆå™¨æ‰©å±•æˆ–å¼€å‘è€…å·¥å…·ï¼‰
   ```

## æ¶ˆæ¯æå–é—®é¢˜

### âŒ æ‰¾ä¸åˆ°æ¶ˆæ¯ / æ¶ˆæ¯æ•°é‡ä¸º 0

**ç°è±¡**ï¼š
```
âœ… æŠ“å–å®Œæˆï¼å…±å‘ç° 0 æ¡æ¶ˆæ¯
```

**åŸå› **ï¼š
1. é¡µé¢é€‰æ‹©å™¨ä¸åŒ¹é…
2. é¡µé¢è¿˜æœªåŠ è½½å®Œæˆ
3. éœ€è¦ç™»å½•æ‰èƒ½çœ‹åˆ°æ¶ˆæ¯

**è§£å†³æ–¹æ³•**ï¼š

**æ­¥éª¤ 1: ä½¿ç”¨éæ— å¤´æ¨¡å¼è§‚å¯Ÿ**

```bash
python3 whop_scraper_simple.py --url "URL"  # å»æ‰ --headless
```

è§‚å¯Ÿæµè§ˆå™¨çª—å£ï¼š
- âœ… æ˜¯å¦æ˜¾ç¤ºäº†æ¶ˆæ¯ï¼Ÿâ†’ é€‰æ‹©å™¨é—®é¢˜ï¼Œç»§ç»­æ­¥éª¤ 2
- âŒ é¡µé¢ç©ºç™½ï¼Ÿâ†’ Cookie é—®é¢˜ï¼Œé‡æ–°ç™»å½•
- âŒ æ˜¾ç¤ºç™»å½•é¡µé¢ï¼Ÿâ†’ Cookie è¿‡æœŸï¼Œé‡æ–°ç™»å½•

**æ­¥éª¤ 2: æ£€æŸ¥é¡µé¢é€‰æ‹©å™¨**

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼š

1. å³é”®ç‚¹å‡»ä¸€æ¡æ¶ˆæ¯
2. é€‰æ‹©"æ£€æŸ¥å…ƒç´ "
3. æŸ¥çœ‹æ¶ˆæ¯çš„ HTML ç»“æ„

å¸¸è§çš„æ¶ˆæ¯é€‰æ‹©å™¨ï¼š
```
[class*="message"]
[class*="Message"]
[class*="post"]
[class*="Post"]
[data-message-id]
article
.prose
```

**æ­¥éª¤ 3: è‡ªå®šä¹‰é€‰æ‹©å™¨**

å¦‚æœé»˜è®¤é€‰æ‹©å™¨ä¸å·¥ä½œï¼Œç¼–è¾‘ `whop_scraper_simple.py`ï¼š

```python
# æ‰¾åˆ°è¿™ä¸€è¡Œï¼ˆçº¦ç¬¬ 165 è¡Œï¼‰
message_selectors = [
    # æ·»åŠ æ‚¨æ‰¾åˆ°çš„é€‰æ‹©å™¨
    'YOUR_CUSTOM_SELECTOR',  # ä¾‹å¦‚: '.message-container'
    '[class*="message"]',
    # ... å…¶ä»–é€‰æ‹©å™¨
]
```

**æ­¥éª¤ 4: å¢åŠ ç­‰å¾…æ—¶é—´**

æœ‰æ—¶é¡µé¢éœ€è¦æ›´é•¿æ—¶é—´æ¸²æŸ“ï¼š

```python
# åœ¨ scrape_messages æ–¹æ³•ä¸­æ‰¾åˆ°è¿™ä¸€è¡Œ
await asyncio.sleep(3)  # æ”¹ä¸ºæ›´å¤§çš„å€¼ï¼Œå¦‚ 5 æˆ– 10
```

### âš ï¸ æ¶ˆæ¯é‡å¤æˆ–ç¼ºå¤±

**åŸå› **ï¼šæ¶ˆæ¯ ID ç”Ÿæˆä¸å”¯ä¸€

**è§£å†³æ–¹æ³•**ï¼š

è„šæœ¬ä½¿ç”¨ä»¥ä¸‹ä¼˜å…ˆçº§ç”Ÿæˆæ¶ˆæ¯ IDï¼š
1. `data-message-id` å±æ€§
2. `id` å±æ€§
3. å†…å®¹çš„ MD5 å“ˆå¸Œ

å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯ä»¥æ”¹è¿› ID ç”Ÿæˆé€»è¾‘ã€‚

## æ€§èƒ½å’Œè¶…æ—¶é—®é¢˜

### âš ï¸ è„šæœ¬è¿è¡Œå¾ˆæ…¢

**å¯èƒ½åŸå› **ï¼š
1. ä½¿ç”¨äº†æœ‰å¤´æ¨¡å¼ï¼ˆæ˜¾ç¤ºæµè§ˆå™¨çª—å£ï¼‰
2. ç­‰å¾…æ—¶é—´è¿‡é•¿
3. æå–æ¶ˆæ¯çš„é€»è¾‘æ•ˆç‡ä½

**ä¼˜åŒ–æ–¹æ³•**ï¼š

```bash
# 1. ä½¿ç”¨æ— å¤´æ¨¡å¼
python3 whop_scraper_simple.py --url "URL" --headless

# 2. å‡å°‘ç›‘æ§æ—¶é•¿
python3 whop_scraper_simple.py --url "URL" --duration 30

# 3. è°ƒæ•´è½®è¯¢é—´éš”ï¼ˆç¼–è¾‘è„šæœ¬ï¼‰
await asyncio.sleep(2)  # æ”¹ä¸º 1 æˆ– 0.5ï¼ˆç§’ï¼‰
```

### âŒ å†…å­˜å ç”¨è¿‡é«˜

**åŸå› **ï¼šé•¿æ—¶é—´è¿è¡Œï¼Œæ¶ˆæ¯ç´¯ç§¯

**è§£å†³æ–¹æ³•**ï¼š

1. **å®šæœŸé‡å¯**ï¼š
```bash
# ä½¿ç”¨è¾ƒçŸ­çš„è¿è¡Œæ—¶é—´ï¼Œç”¨ cron å®šæœŸé‡å¯
*/10 * * * * cd /path && python3 whop_scraper_simple.py --url "URL" --duration 540 --headless
```

2. **é™åˆ¶æ¶ˆæ¯æ•°é‡**ï¼ˆç¼–è¾‘è„šæœ¬ï¼‰ï¼š
```python
# åœ¨ scrape_messages æ–¹æ³•ä¸­
seen_messages = set()

# æ·»åŠ é™åˆ¶
if len(seen_messages) > 1000:
    # æ¸…é™¤æœ€æ—§çš„æ¶ˆæ¯
    seen_messages.clear()
```

## ä¾èµ–å’Œå®‰è£…é—®é¢˜

### âŒ `ModuleNotFoundError: No module named 'playwright'`

**è§£å†³æ–¹æ³•**ï¼š

```bash
pip3 install -r requirements.txt
python3 -m playwright install chromium
```

### âŒ `playwright._impl._api_types.Error: Executable doesn't exist`

**åŸå› **ï¼šPlaywright æµè§ˆå™¨æœªå®‰è£…

**è§£å†³æ–¹æ³•**ï¼š

```bash
python3 -m playwright install chromium

# å¦‚æœä»ç„¶å¤±è´¥ï¼Œå°è¯•å®‰è£…æ‰€æœ‰æµè§ˆå™¨
python3 -m playwright install
```

### âŒ æƒé™é”™è¯¯

**ç°è±¡**ï¼š
```
Permission denied: 'storage_state.json'
```

**è§£å†³æ–¹æ³•**ï¼š

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la storage_state.json

# ä¿®å¤æƒé™
chmod 644 storage_state.json

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œç¡®ä¿ç›®å½•å¯å†™
chmod 755 .
```

## ç¯å¢ƒé—®é¢˜

### âŒ Python ç‰ˆæœ¬è¿‡ä½

**è¦æ±‚**ï¼šPython 3.8+

**æ£€æŸ¥ç‰ˆæœ¬**ï¼š

```bash
python3 --version
```

**å‡çº§ Python**ï¼š

```bash
# macOS
brew install python@3.11

# Ubuntu
sudo apt update
sudo apt install python3.11
```

### âŒ åœ¨ Docker ä¸­è¿è¡Œé—®é¢˜

**é—®é¢˜**ï¼šæ— å¤´æ¨¡å¼éœ€è¦é¢å¤–ä¾èµ–

**è§£å†³æ–¹æ³•**ï¼š

```dockerfile
# Dockerfile
FROM python:3.11-slim

RUN apt-get update && apt-get install -y \
    libnss3 \
    libnspr4 \
    libatk1.0-0 \
    libatk-bridge2.0-0 \
    libcups2 \
    libdrm2 \
    libdbus-1-3 \
    libxkbcommon0 \
    libxcomposite1 \
    libxdamage1 \
    libxfixes3 \
    libxrandr2 \
    libgbm1 \
    libasound2

# ... å…¶ä½™é…ç½®
```

## è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

```bash
# é‡å®šå‘è¾“å‡ºåˆ°æ–‡ä»¶
python3 whop_scraper_simple.py --url "URL" > debug.log 2>&1

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f debug.log
```

### 2. æˆªå›¾è°ƒè¯•

åœ¨è„šæœ¬ä¸­æ·»åŠ æˆªå›¾åŠŸèƒ½ï¼ˆç¼–è¾‘ `whop_scraper_simple.py`ï¼‰ï¼š

```python
# åœ¨è®¿é—®é¡µé¢åæ·»åŠ 
await page.screenshot(path='debug_screenshot.png')
print("æˆªå›¾å·²ä¿å­˜åˆ°: debug_screenshot.png")
```

### 3. ä¿å­˜é¡µé¢ HTML

```python
# ä¿å­˜é¡µé¢å†…å®¹
html = await page.content()
with open('debug_page.html', 'w', encoding='utf-8') as f:
    f.write(html)
print("é¡µé¢ HTML å·²ä¿å­˜")
```

### 4. ä½¿ç”¨ Playwright Inspector

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
PWDEBUG=1 python3 whop_scraper_simple.py --url "URL"
```

è¿™ä¼šæ‰“å¼€ Playwright Inspectorï¼Œå¯ä»¥é€æ­¥æ‰§è¡Œæ“ä½œã€‚

## å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

| é—®é¢˜ | å¿«é€Ÿè§£å†³ |
|------|---------|
| è¶…æ—¶é”™è¯¯ | å·²è‡ªåŠ¨ä¿®å¤ï¼Œå¦‚ä»æœ‰é—®é¢˜å¢åŠ  `timeout` |
| Cookie è¿‡æœŸ | `python3 whop_login.py` |
| æ‰¾ä¸åˆ°æ¶ˆæ¯ | å»æ‰ `--headless` è§‚å¯Ÿæµè§ˆå™¨ |
| è„šæœ¬å¤ªæ…¢ | æ·»åŠ  `--headless` |
| å†…å­˜å ç”¨é«˜ | å‡å°‘ `--duration` å¹¶å®šæœŸé‡å¯ |
| éœ€è¦éªŒè¯ç  | æ‰‹åŠ¨å®ŒæˆåæŒ‰å›è½¦ |
| å®‰è£…å¤±è´¥ | `pip3 install --upgrade pip` ç„¶åé‡è¯• |

## è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ–‡æ¡£**ï¼š
   - [å¿«é€Ÿå‚è€ƒ](./QUICK_REFERENCE.md)
   - [ç™»å½•æŒ‡å—](./WHOP_LOGIN_GUIDE.md)
   - [å®Œæ•´æ–‡æ¡£](./README.md)

2. **å¯ç”¨è°ƒè¯•æ¨¡å¼**ï¼š
   ```bash
   # ä½¿ç”¨éæ— å¤´æ¨¡å¼å¹¶ä¿å­˜æ—¥å¿—
   python3 whop_scraper_simple.py --url "URL" 2>&1 | tee debug.log
   ```

3. **æä¾›è¯¦ç»†ä¿¡æ¯**ï¼š
   æäº¤ Issue æ—¶è¯·åŒ…å«ï¼š
   - å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
   - ä½¿ç”¨çš„å‘½ä»¤
   - Python ç‰ˆæœ¬
   - æ“ä½œç³»ç»Ÿ
   - debug.log å†…å®¹

## é¢„é˜²æ€§ç»´æŠ¤

### å®šæœŸä»»åŠ¡æ¸…å•

- [ ] æ¯å‘¨æµ‹è¯• Cookieï¼š`python3 whop_login.py --test`
- [ ] æ¯æœˆé‡æ–°ç™»å½•ï¼š`python3 whop_login.py`
- [ ] æ£€æŸ¥è„šæœ¬æ›´æ–°
- [ ] æ¸…ç†æ—¥å¿—æ–‡ä»¶
- [ ] å¤‡ä»½é‡è¦çš„ Cookie æ–‡ä»¶

### ç›‘æ§å»ºè®®

```bash
# åˆ›å»ºç›‘æ§è„šæœ¬ monitor.sh
#!/bin/bash
if ! python3 whop_login.py --test 2>&1 | grep -q "âœ…"; then
    echo "Cookie å·²è¿‡æœŸï¼Œå‘é€é€šçŸ¥..."
    # æ·»åŠ é€šçŸ¥é€»è¾‘ï¼ˆé‚®ä»¶ã€Slack ç­‰ï¼‰
fi
```

## è¿›é˜¶ä¼˜åŒ–

### ä½¿ç”¨ä»£ç†

```python
# ç¼–è¾‘è„šæœ¬ï¼Œåœ¨ browser.launch æ—¶æ·»åŠ 
browser = await p.chromium.launch(
    headless=self.headless,
    proxy={
        "server": "http://proxy.example.com:8080",
        "username": "user",
        "password": "pass"
    }
)
```

### è‡ªå®šä¹‰è¯·æ±‚å¤´

```python
# åœ¨ new_context æ—¶æ·»åŠ 
context = await browser.new_context(
    extra_http_headers={
        "X-Custom-Header": "value"
    }
)
```

### ä½¿ç”¨æŒä¹…åŒ–ä¸Šä¸‹æ–‡

```python
# ä½¿ç”¨æŒä¹…åŒ–æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼ˆè‡ªåŠ¨ä¿å­˜æ‰€æœ‰çŠ¶æ€ï¼‰
context = await p.chromium.launch_persistent_context(
    user_data_dir="./user_data",
    headless=False
)
```

æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ–‡æ¡£æˆ–æäº¤ Issueï¼
